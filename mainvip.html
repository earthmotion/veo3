<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VEO 3 UNLIMITED App</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM for dynamic UI -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX transpilation in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Axios for making HTTP requests -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
        /* Basic font and dark mode setup */
        body {
            font-family: sans-serif;
            background-color: #000;
            color: #f3f4f6;
        }
        /* Simple transition for elements to replace framer-motion */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Custom scrollbar for log area */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1f2937; /* gray-800 */
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #4b5563; /* gray-600 */
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* gray-500 */
        }
    </style>
</head>

<body>
    <!-- The root element where the React app will be mounted -->
    <div id="root"></div>

    <!-- CORS Anywhere script to handle API requests -->
    <script>
        (function() {
            var cors_api_host = 'cors-anywhere.herokuapp.com';
            var cors_api_url = 'https://' + cors_api_host + '/';
            var slice = [].slice;
            var origin = window.location.protocol + '//' + window.location.host;
            var open = XMLHttpRequest.prototype.open;
            XMLHttpRequest.prototype.open = function() {
                var args = slice.call(arguments);
                var targetOrigin = /^https?:\/\/([^\/]+)/i.exec(args[1]);
                if (targetOrigin && targetOrigin[0].toLowerCase() !== origin &&
                    targetOrigin[1] !== cors_api_host) {
                    args[1] = cors_api_url + args[1];
                }
                return open.apply(this, args);
            };
        })();
    </script>

    <!-- The React application code, transpiled by Babel -->
    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // Icon components (replaces lucide-react)
        const Icon = ({ name, className }) => {
            const icons = {
                Loader2: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>,
                Video: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m22 8-6 4 6 4V8Z"/><rect width="14" height="12" x="2" y="6" rx="2" ry="2"/></svg>,
                ImageIcon: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>,
                Download: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
                CircleStop: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><rect width="6" height="6" x="9" y="9"/></svg>,
                CircleCheck: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>,
                CircleX: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>,
                Info: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>,
            };
            return icons[name] || null;
        };
        
        // Helper components (simulating shadcn/ui)
        const Card = ({ className, ...props }) => <div className={`bg-gray-900 border border-gray-800 rounded-2xl shadow-sm ${className}`} {...props} />;
        const CardHeader = ({ className, ...props }) => <div className={`p-6 ${className}`} {...props} />;
        const CardTitle = ({ className, ...props }) => <h3 className={`text-lg font-semibold tracking-tight ${className}`} {...props} />;
        const CardDescription = ({ className, ...props }) => <p className={`text-sm text-gray-400 ${className}`} {...props} />;
        const CardContent = ({ className, ...props }) => <div className={`p-6 pt-0 ${className}`} {...props} />;
        const Button = React.forwardRef(({ className, variant = 'primary', size = 'md', ...props }, ref) => (
            <button
                className={`inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 ${
                    {
                        primary: 'bg-gray-50 text-gray-900 hover:bg-gray-200',
                        secondary: 'bg-gray-800 text-gray-50 hover:bg-gray-700',
                        destructive: 'bg-red-500 text-white hover:bg-red-600'
                    }[variant]
                } ${
                    {
                        sm: 'h-9 px-3 rounded-md',
                        md: 'h-10 px-4 py-2 rounded-lg',
                    }[size]
                } ${className}`}
                ref={ref}
                {...props}
            />
        ));
        const Textarea = React.forwardRef(({ className, ...props }, ref) => <textarea className={`flex min-h-[80px] w-full rounded-md border border-gray-800 bg-transparent px-3 py-2 text-sm placeholder:text-gray-400 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-300 disabled:cursor-not-allowed disabled:opacity-50 ${className}`} ref={ref} {...props} />);
        const Label = ({ className, ...props }) => <label className={`text-sm font-medium leading-none ${className}`} {...props} />;

        // Main API client class
        class LunaAI {
          constructor(debug = false) {
            this.debug = debug;
            
            // Obfuscated URLs and keys to prevent simple scraping
            const p = [
                "aHR0cHM6Ly9m", "Z3NpLmtveWVi", "LmFwcC9hcGkv", "dG9vbHMvYnlw", "YXNzY2YvdjU="
            ];
            const p_ = [
                "aHR0cHM6Ly9h", "aWFydGljbGUu", "ZXJ3ZWltYS5h", "aS9hcGkvdjEv", "c2Vjb25kYXJ5", "LXBhZ2UvYXBp", "L2NyZWF0ZQ=="
            ];
            const p__ = [
                "aHR0cHM6Ly9h", "aWFydGljbGUu", "ZXJ3ZWltYS5h", "aS9hcGkvdjEv", "c2Vjb25kYXJ5", "LXBhZ2UvYXBp", "Lw=="
            ];
            const p___ = [
                "MHg0QUFBQUFB", "QWRKWm1OeFc1", "NG8tR3Zk"
            ];

            this.bypassUrl = atob(p.join(''));
            this.createUrl = atob(p_.join(''));
            this.statusUrl = atob(p__.join(''));
            this.sitekey = atob(p___.join(''));

            this._interval = null;
          }

          cancel() {
            if (this._interval) {
              clearInterval(this._interval);
              this._interval = null;
            }
          }

          async bypassCF(url, apikey) {
            const res = await axios.get(this.bypassUrl, {
              params: { apikey, url, sitekey: this.sitekey, mode: "turnstile-min" },
              headers: { 'x-requested-with': 'XMLHttpRequest' }
            });
            return res?.data?.data?.token;
          }

          async createVideo(token, payload) {
            const headers = {
              'Content-Type': 'application/json',
              'verify': token,
              'uniqueid': window.btoa(String(Date.now())) || "",
              'x-requested-with': 'XMLHttpRequest'
            };
            const res = await axios.post(this.createUrl, payload, { headers });
            
            const recordId = res?.data?.data?.recordId;
            if (recordId) {
              return recordId;
            } else {
              const apiMessage = res?.data?.msg || res?.data?.message || JSON.stringify(res.data);
              throw new Error(`API returned an error: ${apiMessage}`);
            }
          }

          async checkStatus(recordId) {
            const res = await axios.get(`${this.statusUrl}${recordId}`, {
                headers: { 'x-requested-with': 'XMLHttpRequest' }
            });
            return res?.data?.data;
          }

          run({
            apikey,
            prompt, imgUrls = [], quality = "720p", duration = 8,
            aspectRatio = "16:9", secondaryPageId = 1946, channel = "VEO3",
            source = "lunaai.video", type = "features", watermarkFlag = false,
            privateFlag = false, isTemp = true, vipFlag = false, model = "veo-3-fast",
            onPoll,
          }) {
            return new Promise(async (resolve, reject) => {
              try {
                if (!apikey) {
                  return reject(new Error("API Key is missing."));
                }
                const token = await this.bypassCF("https://lunaai.video/features/v3-fast", apikey);
                if (!token) return reject(new Error("Bypass token failed. Please ensure the CORS proxy is active."));
                this.debug && console.log("[🛡️ Bypass Success] Token:", token);

                const payload = {
                  prompt, imgUrls, quality, duration, autoSoundFlag: false, soundPrompt: "",
                  autoSpeechFlag: false, speechPrompt: "", speakerId: "Auto", aspectRatio, secondaryPageId,
                  channel, source, type, watermarkFlag, privateFlag, isTemp, vipFlag, model,
                };

                const recordId = await this.createVideo(token, payload);
                this.debug && console.log("[🎬 Video Requested] Record ID:", recordId);

                this._interval = setInterval(async () => {
                  try {
                    const data = await this.checkStatus(recordId);
                    onPoll?.(data);
                    if (data?.state === "success" && data?.completeData) {
                      clearInterval(this._interval);
                      this._interval = null;
                      const result = JSON.parse(data.completeData);
                      this.debug && console.log("[✅ Success]");
                      resolve(result);
                    } else if (data?.failCode || data?.failMsg) {
                      clearInterval(this._interval);
                      this._interval = null;
                      reject(new Error(`[❌ Failed] ${data.failCode || ""} ${data.failMsg || ""}`));
                    }
                  } catch (err) {
                    clearInterval(this._interval);
                    this._interval = null;
                    reject(err);
                  }
                }, 5000);
              } catch (err) {
                reject(err);
              }
            });
          }
        }

        // Utility: Guess video URL from result JSON
        function guessVideoUrl(obj) {
          if (!obj) return undefined;
          let finalUrl = undefined;
          const candidates = [obj.video_url, obj.videoUrl, obj.image_url, obj.imageUrl, obj.url, obj.downloadUrl, obj?.video?.url, obj?.data?.videoUrl, obj?.data?.url];
          for (const c of candidates) { if (typeof c === "string" && c.startsWith("http")) { finalUrl = c; break; } }
          if (!finalUrl) { try { const queue = [obj]; while (queue.length > 0 && !finalUrl) { const cur = queue.shift(); if (typeof cur === 'string' && cur.startsWith('http') && (cur.includes('.mp4') || cur.includes('.jpg') || cur.includes('.png'))) { finalUrl = cur; break; } if (cur && typeof cur === 'object') { for (const v of Object.values(cur)) { queue.push(v); } } } } catch (e) { console.error("Deep URL search failed:", e); } }
          if (finalUrl) { let modifiedUrl = finalUrl.replace(/_watermarked/g, ''); modifiedUrl = modifiedUrl.replace(/\.(jpg|jpeg|png|webp)(\?.*)?$/i, ".mp4"); return modifiedUrl; }
          return undefined;
        }

        function Field({ label, htmlFor, children, hint }) {
          return (
            <div className="space-y-2">
              <Label htmlFor={htmlFor}>{label}</Label>
              {children}
              {hint ? <p className="text-xs text-gray-400">{hint}</p> : null}
            </div>
          );
        }

        function StatusDisplay({ logs, busy, error, videoUrls }) {
            const latestLog = logs.length > 0 ? logs[logs.length - 1] : "";
            const statusText = latestLog.split('—')[1]?.trim() || "Menunggu untuk memulai...";
            const progressMatch = latestLog.match(/\((\d+)%\)/);
            const progress = progressMatch ? parseInt(progressMatch[1], 10) : 0;

            let icon, colorClass, displayStatusText;

            if (error) {
                icon = <Icon name="CircleX" className="h-12 w-12 text-red-500" />;
                colorClass = "bg-red-500";
                displayStatusText = "Terjadi Kesalahan";
            } else if (videoUrls.length === 2) {
                icon = <Icon name="CircleCheck" className="h-12 w-12 text-green-500" />;
                colorClass = "bg-green-500";
                displayStatusText = "Video Berhasil Dibuat!";
            } else if (busy) {
                icon = <Icon name="Loader2" className="h-12 w-12 text-blue-500 animate-spin" />;
                colorClass = "bg-blue-500";
                displayStatusText = statusText;
            } else {
                icon = <Icon name="Info" className="h-12 w-12 text-gray-500" />;
                colorClass = "bg-gray-500";
                displayStatusText = logs.length > 0 ? "Dibatalkan" : "Siap untuk memulai";
            }
            
            const baseProgress = videoUrls.length * 50;
            const currentProgress = progress / 2;
            const totalProgress = baseProgress + currentProgress;

            return (
                <Card>
                    <CardHeader>
                        <CardTitle>Status Proses</CardTitle>
                        <CardDescription>Perkembangan pembuatan video secara real-time</CardDescription>
                    </CardHeader>
                    <CardContent>
                        <div className="flex flex-col items-center text-center space-y-4 pt-4">
                            <div className="fade-in">{icon}</div>
                            <p className="font-medium text-lg h-6">{displayStatusText}</p>
                            <div className="w-full bg-gray-700 rounded-full h-3 overflow-hidden">
                                <div
                                    className={`h-3 rounded-full ${colorClass} transition-all duration-500 ease-in-out`}
                                    style={{ width: `${videoUrls.length === 2 ? 100 : totalProgress}%` }}
                                />
                            </div>
                            <div className="text-xs font-mono space-y-1 w-full text-left bg-gray-800/50 p-3 rounded-lg h-28 overflow-auto custom-scrollbar">
                                {logs.length > 0 ? (
                                    logs.slice(-5).map((l, i) => <div key={i} className="whitespace-pre-wrap break-all">{l}</div>)
                                ) : (
                                    <div className="text-gray-400">Log akan tampil di sini…</div>
                                )}
                            </div>
                        </div>
                    </CardContent>
                </Card>
            );
        }

        function App() {
          const [isAuthenticated, setIsAuthenticated] = useState(false);
          const [passwordInput, setPasswordInput] = useState("");
          const [validUsers, setValidUsers] = useState([]);
          const [passwordError, setPasswordError] = useState("");
          const [isCheckingPassword, setIsCheckingPassword] = useState(true);

          const [tab, setTab] = useState("text");
          const [prompt, setPrompt] = useState("A majestic lion roaring on a rocky outcrop at sunset");
          const [imgUrlsRaw, setImgUrlsRaw] = useState("");
          const [quality, setQuality] = useState("720p");
          const [model, setModel] = useState("veo-3-fast");
          const [busy, setBusy] = useState(false);
          const [logs, setLogs] = useState([]);
          const [videoUrls, setVideoUrls] = useState([]);
          const [error, setError] = useState("");
          const [downloading, setDownloading] = useState(-1);
          const [apiKey, setApiKey] = useState("");
          const [isApiLoading, setIsApiLoading] = useState(false);

          const clientRef = useRef(null);
          
          function pushLog(line) {
            setLogs((prev) => [...prev, `${new Date().toLocaleTimeString()} — ${line}`].slice(-200));
          }

          // Fetch user list for password check
          useEffect(() => {
            async function fetchUsers() {
                try {
                    const response = await fetch('https://cors-anywhere.herokuapp.com/https://earthmotion.github.io/veo3/user.txt');
                    if (!response.ok) {
                        throw new Error('Gagal memuat daftar pengguna.');
                    }
                    const text = await response.text();
                    const users = text.split('\n').map(u => u.trim()).filter(Boolean);
                    setValidUsers(users);
                } catch (error) {
                    console.error("Error fetching user list:", error);
                    setPasswordError("Tidak dapat memverifikasi pengguna. Periksa koneksi Anda dan aktifkan proxy CORS.");
                } finally {
                    setIsCheckingPassword(false);
                }
            }
            fetchUsers();
          }, []);

          // Fetch API key after authentication
          useEffect(() => {
            async function fetchApiKey() {
                const proxiedApiUrl = 'https://cors-anywhere.herokuapp.com/https://earthmotion.github.io/veo3/api.js';
                const originalApiUrl = 'https://earthmotion.github.io/veo3/api.js';
                pushLog(`Memuat Kunci API dari ${originalApiUrl}...`);
                try {
                    setIsApiLoading(true);
                    const response = await fetch(proxiedApiUrl);
                    if (!response.ok) {
                        throw new Error(`Network response was not ok, status: ${response.status}`);
                    }
                    const scriptContent = await response.text();
                    const match = scriptContent.match(/(fgsiapi-[a-f0-9-]+)/);
                    if (match && match[1]) {
                        setApiKey(match[1]);
                        pushLog("✅ Kunci API berhasil dimuat.");
                    } else {
                        throw new Error("Could not find a valid API key in the fetched script.");
                    }
                } catch (error) {
                    console.error("Failed to fetch API key:", error);
                    const errorMessage = `Gagal memuat Kunci API. Periksa koneksi internet Anda, aktifkan proxy CORS, dan segarkan halaman. Detail: ${error.message}`;
                    setError(errorMessage);
                    pushLog(`❌ Error: ${errorMessage}`);
                } finally {
                    setIsApiLoading(false);
                }
            }
            
            if (isAuthenticated) {
                fetchApiKey();
            }
          }, [isAuthenticated]);

          useEffect(() => () => clientRef.current?.cancel(), []);

          const imgUrls = useMemo(
            () => imgUrlsRaw.split(/\n|,/).map((s) => s.trim()).filter(Boolean),
            [imgUrlsRaw]
          );

          async function handleRun() {
            if (!apiKey) {
                setError("API Key is not loaded. Cannot start generation.");
                return;
            }
            setBusy(true);
            setError("");
            setVideoUrls([]);
            setLogs([]);

            const app = new LunaAI(true);
            clientRef.current = app;

            try {
              for (let i = 0; i < 2; i++) {
                pushLog(`Generating video ${i + 1} of 2...`);
                const res = await app.run({
                  apikey: apiKey, prompt,
                  imgUrls: tab === "image" ? imgUrls : [],
                  quality, model, vipFlag: true,
                  onPoll: (data) => {
                    if (!data) return;
                    const pct = data?.percent || data?.progress;
                    const st = data?.state || data?.status;
                    pushLog(`Status (Video ${i + 1}): ${st ?? "…"}${pct ? ` (${pct}%)` : ""}`);
                  },
                });
                const url = guessVideoUrl(res);
                if (url) {
                    setVideoUrls(prev => [...prev, url]);
                    pushLog(`✅ Success — video ${i + 1} generated.`);
                } else {
                    pushLog(`⚠️ Failed to get URL for video ${i + 1}.`);
                }
              }
            } catch (e) {
              console.error(e);
              let errorMessage = e?.message || String(e);
              if (e.isAxiosError) {
                  errorMessage = `Network request failed: ${e.message}.`;
                  if (e.response) { errorMessage += ` (Status: ${e.response.status} ${e.response.statusText})`; }
              }
              const fullError = `${errorMessage} This can be caused by two main issues: 1) The CORS proxy needs activation. Please visit cors-anywhere.herokuapp.com, request access, and try again. 2) Your API Key may be invalid or expired.`;
              setError(fullError);
              pushLog(`❌ Error: ${errorMessage}`);
            } finally {
              setBusy(false);
            }
          }

          function handleCancel() {
            clientRef.current?.cancel();
            setBusy(false);
            pushLog("⏹️ Cancelled by user.");
          }

          async function handleDownload(url, index) {
              setDownloading(index);
              setError('');
              try {
                  const response = await fetch(`https://cors-anywhere.herokuapp.com/${url}`);
                  if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);
                  const blob = await response.blob();
                  const objectUrl = window.URL.createObjectURL(blob);
                  const link = document.createElement('a');
                  link.href = objectUrl;
                  link.download = `veo3-unlimited-video-${index + 1}.mp4`;
                  document.body.appendChild(link);
                  link.click();
                  document.body.removeChild(link);
                  window.URL.revokeObjectURL(objectUrl);
              } catch (err) {
                  console.error('Download failed:', err);
                  setError("Download failed. Please try right-clicking the video and selecting 'Save video as...'. This may be due to a network or proxy issue.");
              } finally {
                  setDownloading(-1);
              }
          }
          
          function handlePasswordSubmit(e) {
            e.preventDefault();
            if (validUsers.includes(passwordInput.trim())) {
                setIsAuthenticated(true);
                setPasswordError("");
            } else {
                setPasswordError("Password atau ID Pengguna salah.");
            }
          }

          if (!isAuthenticated) {
              return (
                  <div className="bg-black text-gray-100 min-h-screen font-sans flex items-center justify-center p-4">
                      <div className="w-full max-w-sm">
                          <Card className="fade-in">
                              <CardHeader>
                                  <CardTitle className="text-center text-xl">Verifikasi Akses</CardTitle>
                                  <CardDescription className="text-center">
                                      Masukkan ID Pengguna Anda untuk melanjutkan.
                                  </CardDescription>
                              </CardHeader>
                              <CardContent>
                                  <form onSubmit={handlePasswordSubmit} className="space-y-4">
                                      <Field label="ID Pengguna" htmlFor="password">
                                          <input
                                              id="password"
                                              type="password"
                                              value={passwordInput}
                                              onChange={(e) => setPasswordInput(e.target.value)}
                                              className="flex h-10 w-full rounded-md border border-gray-800 bg-transparent px-3 py-2 text-sm placeholder:text-gray-400 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-300"
                                              placeholder="••••••••"
                                              disabled={isCheckingPassword}
                                              autoFocus
                                          />
                                      </Field>
                                      {passwordError && <p className="text-sm text-red-500">{passwordError}</p>}
                                      <Button type="submit" className="w-full gap-2" disabled={isCheckingPassword || !passwordInput}>
                                          {isCheckingPassword ? <Icon name="Loader2" className="h-4 w-4 animate-spin" /> : 'Masuk'}
                                      </Button>
                                  </form>
                                   <div className="rounded-xl border border-yellow-500/30 bg-yellow-500/10 p-3 text-xs text-yellow-300 mt-4">
                                      <p>
                                          Jika gagal memuat, silakan{' '}
                                          <a href="https://cors-anywhere.herokuapp.com/" target="_blank" rel="noopener noreferrer" className="underline font-semibold">
                                              aktifkan proxy
                                          </a> terlebih dahulu.
                                      </p>
                                    </div>
                              </CardContent>
                          </Card>
                      </div>
                  </div>
              );
          }

          return (
            <div className="bg-black text-gray-100 min-h-screen font-sans">
              <div className="mx-auto max-w-6xl p-4 sm:p-6 space-y-6">
                <header className="flex items-center justify-between fade-in">
                  <div>
                    <h1 className="text-2xl sm:text-3xl font-bold tracking-tight">VEO 3 UNLIMITED</h1>
                    <p className="text-sm text-gray-400">Karya anda tercipta melalui sentuhan kreativitas dan teknologi AI</p>
                  </div>
                </header>

                <Card>
                  <CardHeader>
                    <CardTitle>Configuration</CardTitle>
                    <CardDescription>Enter your video parameters</CardDescription>
                  </CardHeader>
                  <CardContent className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="space-y-4">
                      <div className="grid grid-cols-2 w-full bg-gray-800 p-1 rounded-md">
                          <button onClick={() => setTab('text')} className={`inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all ${tab === 'text' ? 'bg-gray-900 text-gray-50 shadow-sm' : 'text-gray-400'}`}>
                              <Icon name="Video" className="h-4 w-4" />Text → Video
                          </button>
                          <button onClick={() => setTab('image')} className={`inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all ${tab === 'image' ? 'bg-gray-900 text-gray-50 shadow-sm' : 'text-gray-400'}`}>
                              <Icon name="ImageIcon" className="h-4 w-4" />Image → Video
                          </button>
                      </div>
                      {tab === 'text' && (
                        <div className="pt-4">
                          <Field label="Prompt" htmlFor="prompt-text" hint="Describe the scene for the video">
                            <Textarea id="prompt-text" value={prompt} onChange={(e) => setPrompt(e.target.value)} rows={5} placeholder="Cyberpunk city at night with neon rain…" />
                          </Field>
                        </div>
                      )}
                      {tab === 'image' && (
                        <div className="pt-4 space-y-4">
                          <Field label="Prompt (optional)" htmlFor="prompt-img" hint="Additional guidance for the scene">
                            <Textarea id="prompt-img" value={prompt} onChange={(e) => setPrompt(e.target.value)} rows={3} placeholder="Pan from left to right across the skyline…" />
                          </Field>
                          <Field label="Image URLs" htmlFor="img-urls" hint="One URL per line. Order matters.">
                            <Textarea id="img-urls" value={imgUrlsRaw} onChange={(e) => setImgUrlsRaw(e.target.value)} rows={5} placeholder={`https://placehold.co/600x400/000000/FFFFFF?text=Image+1\nhttps://placehold.co/600x400/FFFFFF/000000?text=Image+2`} />
                          </Field>
                          {!!imgUrls.length && (
                            <div className="grid grid-cols-2 sm:grid-cols-3 gap-3">
                              {imgUrls.map((u, i) => (
                                <div key={i} className="rounded-xl overflow-hidden border border-gray-700">
                                  <img src={u} alt={`img-${i}`} className="w-full h-28 object-cover" onError={(e) => { e.target.onerror = null; e.target.src='https://placehold.co/150x150/333/EEE?text=Invalid'; }} />
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      )}
                    </div>

                    <div className="space-y-4">
                        <div className="grid grid-cols-2 gap-4">
                            <Field label="Quality" htmlFor="quality">
                                <select id="quality" value={quality} onChange={e => setQuality(e.target.value)} className="flex h-10 w-full items-center justify-between rounded-md border border-gray-800 bg-gray-900 px-3 py-2 text-sm">
                                    <option value="480p">480p</option>
                                    <option value="720p">720p</option>
                                    <option value="1080p">1080p</option>
                                </select>
                            </Field>
                            <Field label="Model" htmlFor="model">
                                <select id="model" value={model} onChange={e => setModel(e.target.value)} className="flex h-10 w-full items-center justify-between rounded-md border border-gray-800 bg-gray-900 px-3 py-2 text-sm">
                                    <option value="veo-3-fast">Veo 3 Fast</option>
                                    <option value="veo-3">Veo 3</option>
                                </select>
                            </Field>
                        </div>

                      <div className="flex items-center gap-3 pt-2">
                        <Button onClick={handleRun} disabled={busy || isApiLoading || !apiKey} className="gap-2 px-5 w-36">
                          {isApiLoading ? <Icon name="Loader2" className="h-4 w-4 animate-spin" /> : (busy ? <Icon name="Loader2" className="h-4 w-4 animate-spin" /> : <Icon name="Video" className="h-4 w-4" />)}
                          {isApiLoading ? 'Loading API...' : (busy ? 'Generating...' : 'Generate')}
                        </Button>
                        <Button onClick={handleCancel} disabled={!busy} variant="secondary" className="gap-2">
                          <Icon name="CircleStop" className="h-4 w-4" /> Cancel
                        </Button>
                      </div>
                      
                      <div className="rounded-xl border border-yellow-500/30 bg-yellow-500/10 p-3 text-xs text-yellow-300 mt-auto">
                        <p className="font-medium mb-1">Action Required: Network Proxy</p>
                        <p>
                            This app uses a public proxy. If you see network errors, please{' '}
                            <a href="https://cors-anywhere.herokuapp.com/" target="_blank" rel="noopener noreferrer" className="underline font-semibold">
                                visit the proxy activation page
                            </a>, click the button to request access, and then try generating again.
                        </p>
                      </div>
                    </div>
                  </CardContent>
                </Card>

                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                  <Card className="lg:col-span-2">
                    <CardHeader>
                      <CardTitle>Video Preview</CardTitle>
                      <CardDescription>Menampilkan cuplikan hasil generated video anda.</CardDescription>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      {videoUrls.length > 0 ? (
                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            {videoUrls.map((url, index) => (
                                <div key={index} className="space-y-2">
                                    <video src={url} controls className="w-full rounded-2xl shadow-lg bg-black aspect-video" />
                                    <Button onClick={() => handleDownload(url, index)} disabled={downloading === index} variant="secondary" className="w-full gap-2">
                                        {downloading === index ? <Icon name="Loader2" className="h-4 w-4 animate-spin" /> : <Icon name="Download" className="h-4 w-4" />}
                                        Download Video {index + 1}
                                    </Button>
                                </div>
                            ))}
                        </div>
                      ) : (
                        <div className="text-sm text-gray-500 h-60 flex items-center justify-center bg-gray-800/50 rounded-2xl">
                            {busy ? 'Generating videos...' : 'Your videos will appear here.'}
                        </div>
                      )}
                      {error && (
                        <div className="rounded-xl border border-red-500/30 p-3 text-sm text-red-400 bg-red-500/10">{error}</div>
                      )}
                    </CardContent>
                  </Card>

                  <StatusDisplay logs={logs} busy={busy} error={error} videoUrls={videoUrls} />
                </div>

                <footer className="text-xs text-gray-400 text-center py-4">
                  © {new Date().getFullYear()} — VEO 3 Studio • Built with React & Tailwind. Powered by Arif Kurniawan.
                </footer>
              </div>
            </div>
          );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>

</html>
